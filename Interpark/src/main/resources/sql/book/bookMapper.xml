<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.kosmo.jobkorea.book.dao.bookDao">

	<!-- 도서상품 등록 -->
	<insert id="BookRegister">
		INSERT INTO BOOK_GOODS(
		itemId,isbn,title,description
		,translator,author
		,priceStandard,coverSmallUrl,coverLargeUrl
		,categoryId,categoryName
		,publisher,pubDate
		,`index`,authorInfo
		,stock,saleRate,salePrice,realPrice,regDate
		,file_nm,file_loc,file_size
		<if test="(sellState != null) and (!sellState.equals(''))">
			,sellState
		</if>
		<if test="(display != null) and (!display.equals(''))">
			,display
		</if>
		<if test="!(sellStart.equals('')) and !(sellEnd.equals(''))">
			,sellStart,sellEnd
		</if>
		) VALUES (
		#{book.itemId},#{book.isbn},#{book.title},#{description},
		#{book.translator},#{book.author},
		#{book.priceStandard},#{book.coverSmallUrl},#{book.coverLargeUrl},
		#{book.categoryId},#{book.categoryName},
		#{book.publisher},#{book.pubDate},
		#{index},#{authorInfo},
		#{stock},#{saleRate},#{salePrice},#{realPrice},now(),
		#{file_nm},#{file_loc},#{file_size}
		<if test="(sellState != null) and (!sellState.equals(''))">
			,#{sellState}
		</if>
		<if test="(display != null) and (!display.equals(''))">
			,#{display}
		</if>
		<if test="!(sellStart.equals('')) and !(sellEnd.equals(''))">
			,#{sellStart},#{sellEnd}
		</if>
		)
	</insert>
	<!--카테고리 리스트 -->
	<select id="cateList" resultType="kr.kosmo.jobkorea.book.model.CategoryModel">
		SELECT * FROM CATEGORY
	</select>

<!-- 상품 검색 sql -->
	<sql id="search">
		<where>
		<if test="(searchKey != null) and (!searchKey.equals(''))">
			<choose>
				<when test="(searchType != null) and (searchType eq 'all'.toString())">
					(
					P_ID = #{searchKey } or
					title Like CONCAT('%', #{searchKey }, '%') 
					)
				</when>
				<when test="(searchType != null) and (searchType eq 'title'.toString())">
					title Like CONCAT('%', #{searchKey }, '%') 
				</when>
				<when test="(searchType != null) and (searchType eq 'P_ID'.toString())">
					P_ID = #{searchKey }
				</when>
			</choose>	
		</if>
		</where>
	</sql>

	<!-- 상품 리스트 -->
	<select id="goodsList" resultType="kr.kosmo.jobkorea.book.model.BookModel">
		SELECT P_ID as pId,title, description, translator,
		author,coverSmallUrl, categoryId, categoryName,
		publisher, sellCount, stock, saleRate, salePrice,realPrice, regDate, sellState,
		display,
		DATE_FORMAT(sellStart, '%Y.%m.%d %h:%m') as sellStart, DATE_FORMAT(sellEnd, '%Y.%m.%d
		%h:%m') as sellEnd
		FROM BOOK_GOODS
		<include refid="search"/>
		<if test="(pageIndex != null) and (!pageIndex.equals('')) and (pageSize != null) and (!pageSize.equals(''))">
			LIMIT #{pageIndex}, #{pageSize}
		</if>
	</select>
	
	

	
	<!-- 상품 갯수 -->
	<select id="goodsCount" resultType="Integer">
		SELECT count(P_ID) FROM BOOK_GOODS
		<include refid="search"/>
	</select>


	<delete id="delete">
	</delete>


</mapper>